= ðŸ§± Docs-as-Code CI (docs-ci.yml)
:toc:
:toclevels: 2

== ðŸŽ¯ ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ

Workflow `docs-ci.yml` Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÑƒÑŽ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð²ÑÐµÐ¹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°:
* Markdown
* AsciiDoc
* OpenAPI (`.yaml`, `.yml`)
* Ð¡Ñ‚Ð¸Ð»ÑŒ Ð¸ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð¾Ð»Ð¾Ð³Ð¸Ñ (Vale)

CI Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð¼ Pull Request Ð¸ push Ð² `main`.

== âš™ï¸ ÐŸÐ¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ

| Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ | Ð ÐµÐ¶Ð¸Ð¼ | Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ |
|-----------|--------|-----------|
| `push` Ð² Ð²ÐµÑ‚ÐºÑƒ `main` | **Strict** | ÐžÑˆÐ¸Ð±ÐºÐ¸ Ð¾ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÑŽÑ‚ ÑÐ±Ð¾Ñ€ÐºÑƒ |
| `pull_request` | **Soft** | ÐžÑˆÐ¸Ð±ÐºÐ¸ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÑŽÑ‚ÑÑ Ð² PR, Ð½Ð¾ Ð½Ðµ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÑŽÑ‚ ÑÐ»Ð¸ÑÐ½Ð¸Ðµ |

== ðŸ§° ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ ÑˆÐ°Ð³Ð¸ Ð¿Ð°Ð¹Ð¿Ð»Ð°Ð¹Ð½Ð°

| Ð­Ñ‚Ð°Ð¿ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
|------|-----------|
| ðŸ§­ Checkout repository | ÐšÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐµÑ‚ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ Ð² CI Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ |
| ðŸ§° Build docs-cli image | Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÑ‚ Docker-Ð¾Ð±Ñ€Ð°Ð· Ñ Ð¿Ñ€ÐµÐ´ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¼Ð¸ Ð»Ð¸Ð½Ñ‚ÐµÑ€Ð°Ð¼Ð¸ |
| ðŸš€ Run Docs-as-Code Validation | Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ `.repo/ci/scripts/run-linters.sh` Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° |
| ðŸ“Ž Upload Linter Reports | Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚Ñ‹ Ñ Ð»Ð¾Ð³Ð°Ð¼Ð¸ |
| ðŸ’¬ Comment Summary in PR | ÐŸÑƒÐ±Ð»Ð¸ÐºÑƒÐµÑ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¿Ñ€ÑÐ¼Ð¾ Ð² Pull Request |

== ðŸ§± ÐŸÑ€Ð¸Ð¼ÐµÑ€ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹

[source,text]
----
.repo/
 â”œâ”€â”€ ci/
 â”‚   â”œâ”€â”€ workflows/docs-ci.yml
 â”‚   â””â”€â”€ scripts/run-linters.sh
 â””â”€â”€ config/
     â”œâ”€â”€ .vale.ini
     â”œâ”€â”€ .spectral.yaml
     â”œâ”€â”€ .markdownlint-cli2.jsonc
     â””â”€â”€ .vale/styles/
----

== ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ

Ð•ÑÐ»Ð¸ workflow Ð½Ðµ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð» Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ â€” ÐµÐ³Ð¾ Ð¼Ð¾Ð¶Ð½Ð¾ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ:

1. ÐžÑ‚ÐºÑ€Ð¾Ð¹ Ð²ÐºÐ»Ð°Ð´ÐºÑƒ **Actions** Ð² GitHub.
2. ÐÐ°Ð¹Ð´Ð¸ **Docs-as-Code CI**.
3. ÐÐ°Ð¶Ð¼Ð¸ **Run workflow** Ð¸ Ð²Ñ‹Ð±ÐµÑ€Ð¸ Ð²ÐµÑ‚ÐºÑƒ `main`.

== ðŸ§© ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹

ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð»Ð¸Ð½Ñ‚ÐµÑ€Ñ‹ Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÑŽÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¸Ð·Ð¼ÐµÐ½Ñ‘Ð½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ (`git diff origin/main...HEAD`),  
Ñ‡Ñ‚Ð¾ ÑƒÑÐºÐ¾Ñ€ÑÐµÑ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ñ… Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸ÐµÐ².

== ðŸ§¾ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¸ Ð°Ð½Ð½Ð¾Ñ‚Ð°Ñ†Ð¸Ð¸

* Ð›Ð¾Ð³Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð² Ð°Ñ€Ñ‚ÐµÑ„Ð°ÐºÑ‚Ñ‹ (`artifacts/`)
* PR-ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚:
  - Ð¡Ð²Ð¾Ð´ÐºÑƒ Ð¾ÑˆÐ¸Ð±Ð¾Ðº/Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ð¹
  - Ð ÐµÐ¶Ð¸Ð¼ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ (Soft / Strict)
  - ÐŸÐµÑ€Ð²Ñ‹Ðµ 200 ÑÑ‚Ñ€Ð¾Ðº Ð¸Ð· ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð»Ð¾Ð³Ð°

== ðŸ’¡ ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¸

[source,yaml]
----
- name: ðŸš€ Run Docs-as-Code Validation
  run: |
    docker run --rm -v "$PWD":/work -w /work docs-cli:ci \
      bash .repo/ci/scripts/run-linters.sh
----

== ðŸ“ˆ Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ

* ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð»Ð¸Ð½Ñ‚ÐµÑ€Ð¾Ð² (Yamllint, JSON Schema)
* ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð¾Ð² Ð² Confluence Ð¸Ð»Ð¸ Slack
* ÐŸÑ€Ð¸Ð²ÑÐ·ÐºÐ° Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ñ… Ðº Jira-Ñ‚Ð°ÑÐºÐ°Ð¼

== ðŸ§  Ð ÐµÐ·ÑŽÐ¼Ðµ

âœ… Ð•Ð´Ð¸Ð½Ñ‹Ð¹ CI Ð´Ð»Ñ Ð²ÑÐµÐ¹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸  
âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ð² PR  
âœ… Ð“Ð¸Ð±ÐºÐ¾ÑÑ‚ÑŒ Ð¸ Ñ€Ð°ÑÑˆÐ¸Ñ€ÑÐµÐ¼Ð¾ÑÑ‚ÑŒ  
âœ… Ð¡Ð¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ñ Docker Ð¸ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¾Ð¹


== âš™ï¸Ð¢ÐµÑÑ‚ Ð´Ð¸Ð°Ð³Ñ€Ð°Ð¼

[plantuml, docker-structure, png]
----
@startuml
skinparam linetype ortho
skinparam shadowing false

node "ðŸ“¦ docs-cli:ci" {
  [Python 3.11] as py
  [Ruby 3.3] as rb
  [Node.js] as node
  [Vale] as vale
}

py -[hidden]-> node
node -[hidden]-> rb
rb -[hidden]-> vale

rectangle "ðŸ”§ Ð£Ñ‚Ð¸Ð»Ð¸Ñ‚Ñ‹" {
  [markdownlint-cli2]
  [mdformat]
  [asciidoctor]
  [spectral-cli]
  [rubocop]
  [vale]
}

rectangle "ðŸ“ ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ" {
  [.repo/config/.vale.ini]
  [.repo/config/.spectral.yaml]
  [.repo/config/.markdownlint-cli2.jsonc]
  [.repo/config/.vale/styles/]
}

rectangle "ðŸ§  Ð¡ÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ CI" {
  [.repo/ci/scripts/run-linters.sh]
  [.repo/ci/scripts/run_doctest.rb]
}

vale --> "Vale Styles"
@enduml